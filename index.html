<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mascot Animation</title>
    <style>
        body {
            background-color: rgba(0, 0, 0, 0);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        #mascot-container {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #mascot {
            width: 300px;
            height: 300px;
            transition: all 0.5s ease-in-out;
        }

        .speech-bubble {
            position: absolute;
            top: -60px;
            left: 50%;
            transform: translateX(-50%);
            background-color: white;
            border-radius: 5px;
            padding: 10px;
            box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.1);
            font-size: 16px;
            z-index: 10;
            display: none; /* Initially hidden */
        }

        .button-container {
            margin-top: 20px;
        }

        input[type="text"] {
            font-size: 16px;
            padding: 10px;
            width: 300px;
            margin-right: 10px;
        }

        button {
            font-size: 16px;
            padding: 10px 20px;
        }
    </style>
</head>

<body>
    <div id="mascot-container">
        <img id="mascot" src="neutral.png" alt="Mascot Animation">
        <div id="speechBubble" class="speech-bubble">Hello!</div>
    </div>

    <div class="button-container">
        <input type="text" id="userInput" placeholder="Type a command">
        <button id="submitBtn">Submit</button>
    </div>

    <script>
        let isAnimating = false;

        // Log to check if fetch works
        async function loadActions() {
            try {
                const response = await fetch('mascotActions.json');
                const data = await response.json();
                console.log("Actions loaded: ", data.actions); // Debug log
                return data.actions;
            } catch (error) {
                console.error("Error loading actions from JSON file:", error);
                return [];
            }
        }

        // Log to verify actions execution
        function performActions(actions) {
            if (!actions || actions.length === 0) {
                console.log("No actions to perform");
                return;
            }

            console.log("Starting actions..."); // Debug log
            let index = 0;

            function nextAction() {
                if (index >= actions.length) {
                    console.log("All actions completed");
                    return;
                }

                const action = actions[index];
                console.log("Performing action: ", action); // Debug log

                if (action.say) {
                    displayMessage(action.say);
                }

                if (action.action) {
                    changeMascotAnimation(action.action);
                }

                index++;
                setTimeout(nextAction, 4000); // Wait 4 seconds between actions
            }

            nextAction();
        }

        function changeMascotAnimation(animationFile) {
            if (isAnimating) return;

            isAnimating = true;
            const mascot = document.getElementById('mascot');
            console.log("Changing mascot animation to: ", animationFile); // Debug log
            mascot.src = animationFile;

            setTimeout(() => {
                mascot.src = 'neutral.png'; // Reset mascot to neutral after animation
                isAnimating = false;
            }, 3000);
        }

        function displayMessage(message) {
            const speechBubble = document.getElementById('speechBubble');
            console.log("Displaying message: ", message); // Debug log
            speechBubble.textContent = message;
            speechBubble.style.display = 'block';

            setTimeout(() => {
                speechBubble.style.display = 'none';
            }, 4000);
        }

        // Trigger actions based on user input
        document.getElementById('submitBtn').addEventListener('click', async () => {
            const userInput = document.getElementById('userInput').value.toLowerCase();
            console.log("User input: ", userInput); // Debug log
            const actions = await loadActions();

            if (userInput === 'hey') {
                performActions(actions);
            } else {
                displayMessage("Unknown command. Try 'hey'.");
            }
        });
    </script>
</body>

</html>
